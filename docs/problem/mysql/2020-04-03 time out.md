### 超时报错
日志如下：
```
"message": "
### Error querying database. Cause: com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: Communications link failure
The last packet successfully received from the server was 25,410 milliseconds ago. The last packet sent successfully to the
server was 1 milliseconds ago.
### The error may exist in file [/usr/local/tomcat/webapps/xxx/xxxMapper.xml]
### The error may involve xxx.package.doSth
### The error occurred while setting parameters
### SQL: xxx
### Cause: com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: Communications link failure

The last packet successfully received from the server was 25,410 milliseconds ago. The last
packet sent successfully to the server was 1 milliseconds ago.SQL []; Communications link failure
The last packet successfully received from the server was 25,410 milliseconds ago. The last packet sent
successfully to the server was 1 milliseconds ago.; 
nested exception is com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: Communications link failure
The last packet successfully received from the server was 25,410 milliseconds ago. 
The last packet sent successfully to the server was 1 milliseconds ago."
```

看上面的日志，日常超时抛错中，``received from the server`` 与 ``last packet sent successfully to the server``
往往是相同的，这里却不是。

### 排查
没有储备知识，直接面向互联网编程，搜到[这个](https://blog.csdn.net/yaheng100/article/details/87875474)

咨询dba是不是改了数据库wait_timeout配置，DBA确认在 DBA确认在这配置调试这配置调试。

### 知识
#### 数据库链接池配置 常见配置如何配？
在项目中使用的是阿里的druid,在github中有全面的  
[配置说明](https://github.com/alibaba/druid/wiki/DruidDataSource%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8),
[常规的配置](https://github.com/alibaba/druid/wiki/DruidDataSource%E9%85%8D%E7%BD%AE)

在我们现有的实践中，大部分使用的是通用配置，另外开通了``removeAbandoned``，``validationQuery``，``testWhileIdle``等。  
本次dba调试的是xxx，要求应用方调整：


|              配置              |     缺省值     |                                                                           说明                                                                            |
|:-----------------------------:|:-------------:|:---------------------------------------------------------------------------------------------------------------------------------------------------------:|
|            maxWait            |               |               获取连接时最大等待时间，单位毫秒。配置了maxWait之后，缺省启用公平锁，并发效率会有所下降，如果需要可以通过配置useUnfairLock属性为true使用非公平锁。                |
| timeBetweenEvictionRunsMillis | 1分钟（1.0.14） | 有两个含义：1) Destroy线程会检测连接的间隔时间，如果连接空闲时间大于等于minEvictableIdleTimeMillis则关闭物理连接。2)  testWhileIdle的判断依据，详细看testWhileIdle属性的说明 |
|  minEvictableIdleTimeMillis   |               |                                                                连接保持空闲而不被驱逐的最小时间                                                                 |


