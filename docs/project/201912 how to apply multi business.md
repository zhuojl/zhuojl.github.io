### 如何快速接入多业态

前段时间老板给了一个话题 ``后续我们可能会接入多业态（可以理解为咸鱼要卖各种不同的商品），要如何支持?``，
让团队思考并得出一致认识。

#### 背景
公司主营餐饮，当前部门当初为了快速发展，很多功能或者服务都是从其他地方copy来的，部分页面或许只差距一个简单的字段名称，
就copy一份，代码荣余较多，维护不方便，所以大家比较抵制copy。

#### 前端方案
1. 服务划分，老服务jsp页面分离
2. 技术栈统一，减少维护成本，方便后续扩展、升级、拆分
3. 页面模块化，通过配置模块来实现页面不同业态的不同需求

#### 后端方案
以``如何快速响应需求为目标``，做了首次讨论，结论大致如下：
1. 服务拆分（目前很多代码和其他业务耦合在一起）
3. 增加单元测试，增强系统稳定性，减少系统异常，便于后期重构（常有线上问题，用户增加后问题将更加明显）
2. 代码优化，提供灵活性，扩展性（目前很多代码类，方法块都很大，维护、扩展困难）

#### 冲突
在前后端经过第一次讨论后，小leader找老板一起过方案时，才发现boss的需求是：``**新业务的破坏性很大，新业务的兼容性不好**``，此时如何支持！！！
可以拆分为两个关键问题：
1. 新业态接入，增加的人员如何划分? 是按业态划分，还是按功能点划分？
    1) 开发倾向于 按功能划分，减少知识跨度，比如商品就只维护商品，订单就只维护订单，报表只管报表。
    1) 老板倾向于 按业态划分，理由也是减少知识跨度，业态差距很大时，同时维护多个业态可能知识量过大。同时举例：
        1) 某公司两个部门的订单、商品肯定是划分是不同的团队
        2) 公司的商品部门也是按业态划人员来支持的。
        
        第一个例子，不同团队之间除了依赖基础服务，并没有交集，完全独立，而我们不同，我们不可能让业态从头到尾开始做，既然都是那几个人维护就尽量不要copy！
        第二个例子，商品部门按业态划分，也只是停留在商品上，而不是整个业务所有东西。我们（报表）涉及整个流程，按业态来分人太广。
2. 是否copy

- 开发倾向不copy，因为自己需要维护多套代码，成本更高。
- 老板倾向于copy，copy出来由不同的人维护。

如果让另外的同时再维护类似的代码，于自己也是没什么影响的，单独人来维护是可以更快响应需求。

#### 结论

看情况，如果破坏性很大，copy，专人维护。


### 引申

#### 新业务接入时，是copy服务还是在同一个服务中copy代码，多大算一个服务

1. 单独开服务，单独的数据源

在上家公司，因为微服务成本比较低，当初接入一个积分活动，从老的积分活动copy一份拉了个新服务，单独的数据库配置

2. copy出来，公用数据源

当前公司很多功能就是copy出来，公用数据源，如设置、订单

3. 不copy服务，copy功能

在新功能接入改动不是很大的时候，往往直接快捷的办法就是copy

4. 不copy服务，做功能兼容

当功能的定位是公共服务时，或者破坏性不大时

上面几种可以是相同的人维护，也可能是不同的人维护,但是代码不分开最好就只让相同的人维护，
向负责人提需求来响应需求变更。

那当加入一个新功能，到底按上面的那种方式处理，这里有几个因素要考虑：
1. 维护人员（组织架构）是否相同，如果由不同的人维护，尽量拆开。
2. 微服务成本高低，如果低，直接拆分拉新服务
3. 后续需求量，这个最难判断，如果一开始就知道需求量比较大，需要copy
4. 可以保持持续迭代，有问题持续升级


