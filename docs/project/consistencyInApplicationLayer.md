### 如何在应用层保证多端数据一致性
最近和alsc系统搞融合，需要在两个系统分别做双写，遇到一个问题：如何保证两个系统的一致性。

在之前的系统中，系统分为应用层和核心层，这次的双写为了控制人力成本，也为了最终的单写，改动主要是在**应用层**，通过应用层的模版方法控制调用逻辑。

问题总结：**``如何在应用层，尽量保证两个系统的一致性；以及后期如何做两个系统的数据核对``**。

#### 这是一个分布式系统一致性的问题吗？
说算，也可以算，微服务环境中，多层（领域）之间的数据一致性问题。两个核心层类似分布式系统中的多副本，一般来说多副本中有主副本和从副本，
但这里两个核心层都是主，有点类似**脑裂**，所以cap和base也不太能用上。

也可以不算，因为这和通常系统拆分遇到的数据一致性问题又不同，通常的一致性问题发生在系统与系统之间，比如订单系统与交易系统，交易系统与三方渠道之间，
而现在是应用层保证两个核心层之间一致性的问题。

这里有个关键信息，那就是如果不改两个核心层，在**应用层**无法预先拿到核心层的id，即只能在调用成功后拿到id，正常流程没有问题，但异常流程，
特别是超时的时候，只能通过关键信息（例如名称，编码）来判断是否操作成功，但也有误差，而且增加了复杂度。

再说数据核对，这里没办法做到具体内容的核对，最多做到数据量的核对，但因为超时问题的存在，在两个系统中都可能会存在数据多/少的情况，
核对就没有意义。

#### 方法
##### 预先生成两个系统的id，生成映射关系
通过id可以精准定位数据，极大的帮忙在后续数据补偿和核对。
##### 不在应用层双写，在核心层双写。 
这不算这个标题的答案，只能另辟蹊径。核心层1双写（可以拿到核心层1的id），核心层2对核心层1数据幂等。
