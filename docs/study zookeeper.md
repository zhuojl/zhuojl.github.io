#  zookeeper 学习记录

## 写在前面
新公司使用zookeeper进行配置管理，也使用kafka作为主要消息队列，本来是想先看kafka的，结果kafka依赖zookeeper， 故先学习zookeeper！
这篇是是个人总结的内容，不是入门指导，如果萌新佬看到，请转最后引用部分，谢谢！大佬请执教

## 学习目标
- 对zookeeper有全面了解，了解底层核心原理
- 熟悉常用使用场景及底层实现原理
- 运维相关了解

### 核心算法
zookeeper 并不是直接使用的paxos算法（paxos算法 有待更深入的理解），而是使用ZAB协议
- ZAB 协议全称：Zookeeper Atomic Broadcast（Zookeeper 原子广播协议）。
- ZAB 协议是为分布式协调服务 Zookeeper 专门设计的一种支持崩溃恢复和原子广播协议。
没有master节点时(刚启动的时候，master节点 down掉的时候)，节点A进入looking状态，向其他节点发起投票请求（aSid, aZxid）（sid：自己服务的id，zxid 节点处理事务的最大的id），
当节点B收到请求时，B可能也发起了投票流程，也可能已经完成了投票，它会依次对比zxid、sid取最大的，如果B的投票对象改变了，则再把结果通知给其他节点

.......然后呢..........
#### 数据节点类型
持久节点、临时节点、顺序节点；

持久节点    ： 持久存在
顺序持久节点 ：在节点后增加顺序数字。
临时节点    ：客户端失效，而非tcp连接断开，节点数据删除
顺序临时节点 ：

#### 角色类型
LEADER：
事务请求的唯一调度和处理者，保证集群事务的顺序性

FOLLOWER：ZOOKEEPER 集群状态的跟随者，
- 处理客户端非事务请求，并转发给Leader节点
- 参与事务请求的投票
- 参与Leader选举

Observer：
通FOLLOWER，只不过不参与投票，只用于提升系统读性能

### 常用场景及原理
核心原理有：
    1. zookeeper可以给节点添加监听器，当某个节点的新增、编辑、删除、增减子节点时都会触发通事件通知
    2. zookeeper具有分布式一致性的特性，如果路径已经创建，第二个创建肯定不成功（只有master对外提供服务，感觉是好控制的）

- 数据发布与订阅 即常用的配置中心，
依靠的是(1)，配合watcher变更配置
- 命名服务，要求全局唯一名称
顺序节点
- 集群管理
临时节点+watcher
- master选举
依靠（2），谁先注册上，谁就是master
- 分布式锁
依靠（2）

### 运维
常用命令。

## 缺点
[知乎](https://www.zhihu.com/question/42931473)

## 写在后面


## 参考
《从PAXOS到zookeeper分布式一致性原理与实践》
[别人的总结](https://juejin.im/post/5c989f6e5188252d785f2333)